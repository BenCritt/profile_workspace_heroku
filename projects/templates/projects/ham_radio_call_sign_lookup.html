{% extends "projects/base.html" %}
{% load static %}

{% block scripts %}
  {% include "includes/schemas/ham_radio_lookup_schema.html" %}
{% endblock scripts %}

{% block meta_tags %}
  {% include "includes/meta_tags/ham_radio_call_sign_lookup_meta.html" %}
{% endblock meta_tags %}

{% block link_tags %}
  {{ block.super }}
  <link rel="canonical" href="https://www.bencritt.net/projects/ham-radio-call-sign-lookup/">
{% endblock link_tags %}

{% block page_stylesheets %}
    <link href="{% static 'template_css/ham_radio_call_sign_lookup.css' %}" rel="stylesheet">
{% endblock page_stylesheets %}

{% block title %}Ham Radio Call Sign Lookup | Look Up Amateur Radio Call Signs{% endblock title %}

{% block content %}
<div class="container py-5 mx-auto mb-5 lookup-container">
  <h1 class="text-center mb-4">Ham Radio Call Sign Lookup</h1>
  
    <form method="post" class="d-flex flex-column align-items-center gap-3 mb-4" data-gtm-tool="Call Sign Lookup" data-gtm-category="Radio Tools">
        {% csrf_token %}
        <div class="w-100">
            {{ form.as_p }}
        </div>
        <button type="submit" class="btn btn-primary w-100">
            Look Up Call Sign
        </button>
        
        <a href="{% url 'projects:radio_tools' %}" id="hub-link" class="btn btn-secondary w-100 mt-0">
            <i class="bi bi-grid-3x3-gap-fill me-2"></i>Go to Radio Hobbyist Toolkit
        </a>
    </form>

  {% if error %}
    <div class="alert alert-danger text-center mt-3" role="alert">{{ error }}</div>
  {% endif %}

  {% if data and data.status == "VALID" %}
    <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h2 class="h3 card-title d-flex justify-content-between align-items-center">
          {{ data.current.callsign }}
          <span class="badge bg-{% if data.status == 'VALID' %}success{% else %}danger{% endif %} fs-6">
              {{ data.status }}
          </span>
        </h2>
        <hr>
        <dl class="row mb-0">
          <dt class="col-5 col-md-4 text-muted">Name</dt>
          <dd class="col-7 col-md-8 fw-bold">{{ data.name }}</dd>

          <dt class="col-5 col-md-4 text-muted">Class</dt>
          <dd class="col-7 col-md-8">{{ data.current.operClass|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Type</dt>
          <dd class="col-7 col-md-8">{{ data.type|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Expires</dt>
          <dd class="col-7 col-md-8">{{ data.otherInfo.expiryDate|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Grid</dt>
          <dd class="col-7 col-md-8">{{ data.location.gridsquare|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Lat / Long</dt>
          <dd class="col-7 col-md-8">
            {{ data.location.latitude|floatformat:4 }}, 
            {{ data.location.longitude|floatformat:4 }}
            {% if data.location.latitude %}
              <a href="https://www.google.com/maps/search/?api=1&query={{ data.location.latitude }},{{ data.location.longitude }}"
                 target="_blank" rel="noopener" class="btn btn-sm btn-outline-secondary ms-2"
                 aria-label="View coordinates on Google Maps">
                 <i class="bi bi-map-fill"></i> Map
              </a>
            {% endif %}
          </dd>
        </dl>
      </div>
    </div>

    <div class="accordion mt-4" id="lookupAcc">
      <div class="accordion-item">
        <h2 class="accordion-header" id="regHead">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#regBody" aria-expanded="false" aria-controls="regBody">
            Regulatory Details
          </button>
        </h2>
        <div id="regBody" class="accordion-collapse collapse" aria-labelledby="regHead" data-bs-parent="#lookupAcc">
          <div class="accordion-body">
            <dl class="row mb-0">

              <dt class="col-5 col-md-4">FRN
                {% if data.otherInfo.frn %}
                  <button class="btn btn-sm btn-link p-0 ms-1 align-baseline"
                          onclick="navigator.clipboard.writeText('{{ data.otherInfo.frn }}')"
                          title="Copy FRN" aria-label="Copy FRN to clipboard">
                      <i class="bi bi-clipboard"></i>
                  </button>
                {% endif %}
              </dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.frn|default:"—" }}</dd>

              <dt class="col-5 col-md-4">Grant date</dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.grantDate|default:"—" }}</dd>

              <dt class="col-5 col-md-4">Last action</dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.lastActionDate|default:"—" }}</dd>

              <dt class="col-5 col-md-4">Radio service</dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.service|default:"—" }}</dd>

              <dt class="col-5 col-md-4">ULS record</dt>
              <dd class="col-7 col-md-8">
                {% if data.otherInfo.ulsUrl %}
                  <a href="{{ data.otherInfo.ulsUrl }}" target="_blank" rel="noopener">View on FCC ULS</a>
                {% else %}—{% endif %}
              </dd>
            </dl>
          </div>
        </div>
      </div>

      {% if data.trustee.callsign %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="trustHead">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#trustBody" aria-expanded="false" aria-controls="trustBody">
            Trustee / Club Details
          </button>
        </h2>
        <div id="trustBody" class="accordion-collapse collapse" aria-labelledby="trustHead" data-bs-parent="#lookupAcc">
          <div class="accordion-body">
            <dl class="row mb-0">
              <dt class="col-5 col-md-4">Trustee</dt>
              <dd class="col-7 col-md-8">
                  {{ data.trustee.callsign }} – {{ data.trustee.name }}
              </dd>
              <dt class="col-5 col-md-4">Prev. callsign</dt>
              <dd class="col-7 col-md-8">{{ data.previous.callsign|default:"—" }}</dd>
              <dt class="col-5 col-md-4">Prev. class</dt>
              <dd class="col-7 col-md-8">{{ data.previous.operClass|default:"—" }}</dd>
            </dl>
          </div>
        </div>
      </div>
      {% endif %}

      {% if data.address.line1 %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="addrHead">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#addrBody" aria-expanded="false" aria-controls="addrBody">
            Mailing Address
          </button>
        </h2>
        <div id="addrBody" class="accordion-collapse collapse" aria-labelledby="addrHead" data-bs-parent="#lookupAcc">
          <div class="accordion-body">
            <address class="mb-0">
                {{ data.address.line1 }}<br>
                {% if data.address.line2 %}{{ data.address.line2 }}<br>{% endif %}
                {% if data.address.attn %}{{ data.address.attn }}{% endif %}
            </address>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

  {% elif data and data.status != "VALID" %}
      <div class="alert alert-warning text-center mt-4" role="alert">
        <strong>{{ form.data.callsign|default:"The input" }}</strong> is not a valid call-sign or was not found.
      </div>
  {% endif %}

  {# ============================================================= #}
  {#  EDUCATIONAL CONTENT — hidden when embedded in an iframe       #}
  {# ============================================================= #}
  <div class="related-tools-block">

    {# --- License Class Quick Reference --- #}
    <div class="mt-5">
      <h3 class="h5 mb-3 text-muted">US Amateur License Classes — Quick Reference</h3>
      <div class="table-responsive">
        <table class="table table-sm table-striped align-middle">
          <thead>
            <tr>
              <th>Class</th>
              <th>Code</th>
              <th>HF Privileges</th>
              <th>VHF/UHF</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="badge bg-primary">Amateur Extra</span></td>
              <td class="font-monospace">E</td>
              <td>Full — all bands and all sub-band segments</td>
              <td>Full</td>
            </tr>
            <tr>
              <td><span class="badge bg-info text-dark">Advanced</span></td>
              <td class="font-monospace">A</td>
              <td>Most HF segments; slightly fewer than Extra (grandfathered — no longer issued)</td>
              <td>Full</td>
            </tr>
            <tr>
              <td><span class="badge bg-success">General</span></td>
              <td class="font-monospace">G</td>
              <td>Most HF segments; Extra-only sub-bands restricted</td>
              <td>Full</td>
            </tr>
            <tr>
              <td><span class="badge bg-warning text-dark">Technician</span></td>
              <td class="font-monospace">T</td>
              <td>10m phone + CW on narrow portions of 80/40/15m (200 W PEP)</td>
              <td>Full</td>
            </tr>
            <tr>
              <td><span class="badge bg-light text-dark">Novice</span></td>
              <td class="font-monospace">N</td>
              <td>CW on portions of 80/40/15/10m (grandfathered — no longer issued)</td>
              <td>Limited</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    {# --- Educational Section --- #}
    <div class="mt-5">
      <h3 class="h5 mb-3 text-muted">Understanding US Amateur Radio Call Signs</h3>
      <p class="small text-muted mb-2">
          <strong>Call sign structure:</strong> US amateur call signs follow a standard format: one or two prefix letters, a single region digit (0–9), and a one-to-three letter suffix. The prefix indicates the license class and era of issuance. Single-letter prefixes (W, K, N) and two-letter AA–AL prefixes are the most common. Extra class licensees are eligible for the shortest "1×2" or "2×1" format call signs (e.g. W1AB or AA1B); Technicians are typically issued 2×3 format signs.
      </p>
      <p class="small text-muted mb-2">
          <strong>Region numbers:</strong> The digit in a call sign roughly corresponds to the geographic region where the license was first issued — Region 1 covers New England, Region 7 covers the Pacific Northwest, and so on. However, call signs are not required to match the operator's current location; operators keep their original call sign when moving between regions.
      </p>
      <p class="small text-muted mb-2">
          <strong>The FCC ULS database:</strong> All US amateur radio licenses are maintained in the FCC's Universal Licensing System (ULS). This tool queries the ULS in real time via the <a href="https://callook.info/" target="_blank" rel="noopener">Callook.info API</a>. The data shown — including name, address, grid square, and expiration date — reflects the licensee's mailing address on file with the FCC, which may differ from their actual operating location.
      </p>
      <p class="small text-muted mb-2">
          <strong>FRN (FCC Registration Number):</strong> Every FCC licensee is assigned a unique FRN for managing their licenses through the FCC's online systems. An FRN can hold multiple licenses across different radio services (e.g. amateur, GMRS) under a single account. The FRN shown here is required when filing paperwork with the FCC.
      </p>
      <p class="small text-muted mb-2">
          <strong>Club and trustee call signs:</strong> Amateur radio clubs are licensed under a club call sign, with an individual licensee (the trustee) responsible for its proper use. The trustee's personal call sign appears in the Trustee accordion above. Club call signs follow the same format as individual signs but are associated with the club's mailing address rather than an individual.
      </p>
      <p class="small text-muted mb-2">
          <strong>License renewal and expiration:</strong> US amateur licenses are valid for 10 years. Licenses can be renewed online through the FCC ULS starting 90 days before expiration. There is a 2-year grace period after expiration during which a license can be reinstated without retesting — but operating while expired is not permitted.
      </p>
      <p class="small text-muted">
          <strong>Grid square note:</strong> The Maidenhead grid square shown is derived from the licensee's mailing address geocode, not a GPS coordinate. For portable or rover operations, operators typically report their actual operating grid square in their logbook and contest exchange. Use the <a href="{% url 'projects:grid_square_converter' %}">Grid Square Converter</a> to find the grid for any coordinates or ZIP code.
      </p>
    </div>

    {# --- Related Tools --- #}
    <div class="mt-4">
      <p class="small text-muted">
        <strong>Related radio tools:</strong> The grid square shown above is derived from the licensee's mailing address — use the <a href="{% url 'projects:grid_square_converter' %}" class="related-tool-link">Grid Square Converter</a> to find the precise Maidenhead locator for any coordinates or ZIP code instead. If you're traveling and want to know which repeaters you'll have access to along the way, the <a href="{% url 'projects:repeater_finder' %}" class="related-tool-link">Repeater Finder</a> searches open VHF and UHF repeaters by driving route. To look up what modes and power limits apply to a specific frequency, use the <a href="{% url 'projects:band_plan_checker' %}" class="related-tool-link">Band Plan Checker</a>.
      </p>
    </div>

  </div>{# end related-tools-block #}

  <div class="text-center mt-5">
    {% include 'includes/attribution.html' %}
  </div>
</div>

<script>
    // Hide Hub button if loaded within an iframe
    if (window.self !== window.top) {
        const hubLink = document.getElementById('hub-link');
        if (hubLink) hubLink.style.display = 'none';
    }
</script>
{% endblock content %}
