{% extends "projects/base.html" %}
{% load static %}

{% block scripts %}
  {% include "includes/schemas/ham_radio_lookup_schema.html" %}
{% endblock scripts %}

{% block meta_tags %}
  {% include "includes/meta_tags/ham_radio_call_sign_lookup_meta.html" %}
{% endblock meta_tags %}

{% block link_tags %}
  {{ block.super }}
  <link rel="canonical" href="https://www.bencritt.net/projects/ham-radio-call-sign-lookup/">
{% endblock link_tags %}

{% block page_stylesheets %}
    <link href="{% static 'template_css/ham_radio_call_sign_lookup.css' %}" rel="stylesheet">
{% endblock page_stylesheets %}

{% block title %}Ham Radio Call Sign Lookup | Look Up Amateur Radio Call Signs{% endblock title %}

{% block content %}
<div class="container py-5 mx-auto mb-5 lookup-container">
  <h1 class="text-center mb-4">Ham Radio Call Sign Lookup</h1>
  
    <form method="post" class="d-flex flex-column align-items-center gap-3 mb-4" data-gtm-tool="Call Sign Lookup" data-gtm-category="Radio Tools">
        {% csrf_token %}
        <div class="w-100">
            {{ form.as_p }}
        </div>
        <button type="submit" class="btn btn-primary w-100">
            Look Up Call Sign
        </button>
        
        <a href="{% url 'projects:radio_tools' %}" id="hub-link" class="btn btn-secondary w-100 mt-0">
            <i class="bi bi-grid-3x3-gap-fill me-2"></i>Go to Radio Hobbyist Toolkit
        </a>
    </form>

  {% if error %}
    <div class="alert alert-danger text-center mt-3" role="alert">{{ error }}</div>
  {% endif %}

  {% if data and data.status == "VALID" %}
    <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h2 class="h3 card-title d-flex justify-content-between align-items-center">
          {{ data.current.callsign }}
          <span class="badge bg-{% if data.status == 'VALID' %}success{% else %}danger{% endif %} fs-6">
              {{ data.status }}
          </span>
        </h2>
        <hr>
        <dl class="row mb-0">
          <dt class="col-5 col-md-4 text-muted">Name</dt>
          <dd class="col-7 col-md-8 fw-bold">{{ data.name }}</dd>

          <dt class="col-5 col-md-4 text-muted">Class</dt>
          <dd class="col-7 col-md-8">{{ data.current.operClass|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Type</dt>
          <dd class="col-7 col-md-8">{{ data.type|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Expires</dt>
          <dd class="col-7 col-md-8">{{ data.otherInfo.expiryDate|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Grid</dt>
          <dd class="col-7 col-md-8">{{ data.location.gridsquare|default:"—" }}</dd>

          <dt class="col-5 col-md-4 text-muted">Lat / Long</dt>
          <dd class="col-7 col-md-8">
            {{ data.location.latitude|floatformat:4 }}, 
            {{ data.location.longitude|floatformat:4 }}
            {% if data.location.latitude %}
              <a href="https://www.google.com/maps/search/?api=1&query={{ data.location.latitude }},{{ data.location.longitude }}"
                 target="_blank" rel="noopener" class="btn btn-sm btn-outline-secondary ms-2"
                 aria-label="View coordinates on Google Maps">
                 <i class="bi bi-map-fill"></i> Map
              </a>
            {% endif %}
          </dd>
        </dl>
      </div>
    </div>

    <div class="accordion mt-4" id="lookupAcc">
      <div class="accordion-item">
        <h2 class="accordion-header" id="regHead">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#regBody" aria-expanded="false" aria-controls="regBody">
            Regulatory Details
          </button>
        </h2>
        <div id="regBody" class="accordion-collapse collapse" aria-labelledby="regHead" data-bs-parent="#lookupAcc">
          <div class="accordion-body">
            <dl class="row mb-0">

              <dt class="col-5 col-md-4">FRN
                {% if data.otherInfo.frn %}
                  <button class="btn btn-sm btn-link p-0 ms-1 align-baseline"
                          onclick="navigator.clipboard.writeText('{{ data.otherInfo.frn }}')"
                          title="Copy FRN" aria-label="Copy FRN to clipboard">
                      <i class="bi bi-clipboard"></i>
                  </button>
                {% endif %}
              </dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.frn|default:"—" }}</dd>

              <dt class="col-5 col-md-4">Grant date</dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.grantDate|default:"—" }}</dd>

              <dt class="col-5 col-md-4">Last action</dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.lastActionDate|default:"—" }}</dd>

              <dt class="col-5 col-md-4">Radio service</dt>
              <dd class="col-7 col-md-8">{{ data.otherInfo.service|default:"—" }}</dd>

              <dt class="col-5 col-md-4">ULS record</dt>
              <dd class="col-7 col-md-8">
                {% if data.otherInfo.ulsUrl %}
                  <a href="{{ data.otherInfo.ulsUrl }}" target="_blank" rel="noopener">View on FCC ULS</a>
                {% else %}—{% endif %}
              </dd>
            </dl>
          </div>
        </div>
      </div>

      {% if data.trustee.callsign %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="trustHead">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#trustBody" aria-expanded="false" aria-controls="trustBody">
            Trustee / Club Details
          </button>
        </h2>
        <div id="trustBody" class="accordion-collapse collapse" aria-labelledby="trustHead" data-bs-parent="#lookupAcc">
          <div class="accordion-body">
            <dl class="row mb-0">
              <dt class="col-5 col-md-4">Trustee</dt>
              <dd class="col-7 col-md-8">
                  {{ data.trustee.callsign }} – {{ data.trustee.name }}
              </dd>
              <dt class="col-5 col-md-4">Prev. callsign</dt>
              <dd class="col-7 col-md-8">{{ data.previous.callsign|default:"—" }}</dd>
              <dt class="col-5 col-md-4">Prev. class</dt>
              <dd class="col-7 col-md-8">{{ data.previous.operClass|default:"—" }}</dd>
            </dl>
          </div>
        </div>
      </div>
      {% endif %}

      {% if data.address.line1 %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="addrHead">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#addrBody" aria-expanded="false" aria-controls="addrBody">
            Mailing Address
          </button>
        </h2>
        <div id="addrBody" class="accordion-collapse collapse" aria-labelledby="addrHead" data-bs-parent="#lookupAcc">
          <div class="accordion-body">
            <address class="mb-0">
                {{ data.address.line1 }}<br>
                {% if data.address.line2 %}{{ data.address.line2 }}<br>{% endif %}
                {% if data.address.attn %}{{ data.address.attn }}{% endif %}
            </address>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

  {% elif data and data.status != "VALID" %}
      <div class="alert alert-warning text-center mt-4" role="alert">
        <strong>{{ form.data.callsign|default:"The input" }}</strong> is not a valid call-sign or was not found.
      </div>
  {% endif %}

  <div class="text-center mt-5">
    {% include 'includes/attribution.html' %}
  </div>
</div>

<script>
    // Hide Hub button if loaded within an iframe
    if (window.self !== window.top) {
        const hubLink = document.getElementById('hub-link');
        if (hubLink) hubLink.style.display = 'none';
    }
</script>
{% endblock content %}