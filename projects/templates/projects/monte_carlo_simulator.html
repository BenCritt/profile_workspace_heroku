{% extends "projects/base.html" %}
{% load static %}

{% block scripts %}    
    <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const one = document.getElementById('one-range-fields');
      const two = document.getElementById('two-range-fields');

      // Radio buttons that control the range mode
      const radios = document.querySelectorAll('input[name="data-range"]');

      function toggleFields(value) {
        const showTwo = value === 'two';
        two.classList.toggle('d-none', !showTwo);   // toggle visibility class
      }

      // Run once on load to restore state (e.g., after validation error)
      const selected = document.querySelector('input[name="data-range"]:checked');
      if (selected) toggleFields(selected.value);

      // Listen for changes
      radios.forEach(radio =>
        radio.addEventListener('change', e => toggleFields(e.target.value))
      );
    });
    </script>
    
    {% include "includes/schemas/monte_carlo_schema.html" %}
{% endblock scripts %}

{% block meta_tags %}
    <meta http-equiv="Cache-Control"  content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma"         content="no-cache">
    <meta http-equiv="Expires"        content="0">
    
    <meta name="description"          content="The Monte Carlo Simulator allows you to take one or two number ranges, randomly generate values within those ranges, select target values, and graph them out onto a PDF file that is downloaded to your computer and placed in your default downloads folder.">
    
    <meta property="og:url"           content="https://www.bencritt.net/projects/monte-carlo-simulator/">
    <meta property="og:type"          content="website">
    <meta property="og:title"         content="Monte Carlo Simulator">
    <meta property="og:description"   content="This Monte Carlo simulator can take one or two data ranges, execute a chosen number of simulations, and graph the results onto a PDF that’s downloaded to your device.">
    <meta property="og:image"         content="https://www.bencritt.net/static/img/all-projects/monte-carlo-simulator.webp">
    <meta property="og:image:type"    content="image/webp">
    <meta property="og:image:alt"     content="Monte Carlo Simulator Screenshot">
    <meta property="og:site_name"     content="Ben Crittenden">

    <meta name="twitter:card"         content="summary_large_image">
    <meta name="twitter:domain"       content="bencritt.net">
    <meta name="twitter:url"          content="https://www.bencritt.net/projects/monte-carlo-simulator/">
    <meta name="twitter:title"        content="Monte Carlo Simulator">
    <meta name="twitter:description"  content="This Monte Carlo simulator can take one or two data ranges, execute a chosen number of simulations, and graph the results onto a PDF that’s downloaded to your device.">
    <meta name="twitter:image"        content="https://www.bencritt.net/static/img/all-projects/monte-carlo-simulator.webp">
    <meta name="twitter:creator"      content="@bencritt89">
{% endblock meta_tags %}

{% block link_tags %}
    <link rel="canonical" href="https://www.bencritt.net/projects/monte-carlo-simulator/">
{% endblock link_tags %}

{% block title %}Monte Carlo Simulator | Data Range Simulations and PDF Graphs{% endblock title %}

{% block content %}
<div class="container py-5 d-flex flex-column align-items-center">
    
    <h1 class="mb-4">Monte Carlo Simulator</h1>
    
    <div class="w-100" style="max-width: 500px;">
        <form method="post" action="{% url 'projects:monte_carlo_simulator' %}" class="d-flex flex-column gap-3">
            {% csrf_token %} 
            
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div class="card p-3 mb-3 bg-body-secondary border-0">
                <label class="form-label fw-bold mb-2">Select Range Mode:</label>
                <div class="d-flex gap-4">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="data-range" id="one-range" value="one" checked>
                        <label class="form-check-label" for="one-range">One Range</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="data-range" id="two-ranges" value="two">
                        <label class="form-check-label" for="two-ranges">Two Ranges</label>
                    </div>
                </div>
            </div>

            <div id="one-range-fields" class="d-flex flex-column gap-3">
                <div>
                    {{ form.sim_quantity.label_tag }}
                    {{ form.sim_quantity }}
                    {% if form.sim_quantity.errors %}
                        <div class="text-danger small mt-1">{{ form.sim_quantity.errors.0 }}</div>
                    {% endif %}
                </div>

                <div>
                    {{ form.min_val.label_tag }}
                    {{ form.min_val }}
                    {% if form.min_val.errors %}
                        <div class="text-danger small mt-1">{{ form.min_val.errors.0 }}</div>
                    {% endif %}
                </div>

                <div>
                    {{ form.max_val.label_tag }}
                    {{ form.max_val }}
                    {% if form.max_val.errors %}
                        <div class="text-danger small mt-1">{{ form.max_val.errors.0 }}</div>
                    {% endif %}
                </div>

                <div>
                    {{ form.target_val.label_tag }}
                    {{ form.target_val }}
                    {% if form.target_val.errors %}
                        <div class="text-danger small mt-1">{{ form.target_val.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div id="two-range-fields" class="d-none d-flex flex-column gap-3 border-top pt-3 mt-2">
                <h5 class="text-muted fs-6">Second Range Settings</h5>
                
                <div>
                    {{ form.second_sim_quantity.label_tag }}
                    {{ form.second_sim_quantity }}
                    {% if form.second_sim_quantity.errors %}
                        <div class="text-danger small mt-1">{{ form.second_sim_quantity.errors.0 }}</div>
                    {% endif %}
                </div>

                <div>
                    {{ form.second_min_val.label_tag }}
                    {{ form.second_min_val }}
                    {% if form.second_min_val.errors %}
                        <div class="text-danger small mt-1">{{ form.second_min_val.errors.0 }}</div>
                    {% endif %}
                </div>

                <div>
                    {{ form.second_max_val.label_tag }}
                    {{ form.second_max_val }}
                    {% if form.second_max_val.errors %}
                        <div class="text-danger small mt-1">{{ form.second_max_val.errors.0 }}</div>
                    {% endif %}
                </div>

                <div>
                    {{ form.second_target_val.label_tag }}
                    {{ form.second_target_val }}
                    {% if form.second_target_val.errors %}
                        <div class="text-danger small mt-1">{{ form.second_target_val.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>

            <input type="submit" id="monte-carlo-btn" class="btn btn-primary w-100 mt-4" value="Run Simulation" aria-label="Run Simulation">
        </form>
    </div>
    
    <p class="mt-4 text-center text-muted">Your graph will be downloaded and placed into your default downloads folder.</p>
    
    <div class="mt-5 text-center">
        {% include 'includes/attribution.html' %}
    </div>

</div>
{% endblock content %}