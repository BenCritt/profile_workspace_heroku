{% extends "projects/base.html" %}
{% load static %}

{% block scripts %}
  {% include "includes/schemas/whois_lookup_schema.html" %}
{% endblock scripts %}

{% block meta_tags %}
    {% include "includes/meta_tags/whois_lookup_meta.html" %}
{% endblock meta_tags %}

{% block link_tags %}
    {{ block.super }}
    <link rel="canonical" href="https://www.bencritt.net/projects/whois-lookup/">
{% endblock link_tags %}

{% block page_stylesheets %}
    <link href="{% static 'template_css/whois_lookup.css' %}" rel="stylesheet">
{% endblock page_stylesheets %}

{% block title %}WHOIS Lookup Tool | Domain Registration Details{% endblock title %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="text-center mb-4">WHOIS Lookup Tool</h1>
            
            <div class="card shadow-sm mb-5">
                <div class="card-body">
                    <form method="post" data-gtm-tool="WHOIS Lookup Tool" data-gtm-category="IT Tools">
                        {% csrf_token %}
                        <div class="row g-3">
                            <div class="col-md-9">
                                <label for="{{ form.domain.id_for_label }}" class="form-label">Domain Name</label>
                                {{ form.domain }}
                            </div>
                            <div class="col-md-3 d-flex flex-column justify-content-end">
                                <button type="submit" class="btn btn-primary w-100">Lookup</button>
                                <a href="{% url 'projects:it_tools' %}" class="btn btn-secondary mt-2 w-100">Go to All IT Tools</a>
                            </div>
                        </div>
                        {% if form.errors %}
                            <div class="alert alert-danger mt-3">{{ form.errors.domain.0 }}</div>
                        {% endif %}
                    </form>
                </div>
            </div>

            {% if error_message %}
                <div class="alert alert-warning shadow-sm">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ error_message }}
                </div>
            {% endif %}

            {% if results %}
            <div id="results-section" class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="h5 mb-0">Results for {{ domain }}</h2>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <tbody>
                                <tr>
                                    <th style="width: 30%;">Registrar</th>
                                    <td>{{ results.registrar }}</td>
                                </tr>
                                <tr>
                                    <th>Creation Date</th>
                                    <td>{{ results.creation_date }}</td>
                                </tr>
                                <tr>
                                    <th>Expiration Date</th>
                                    <td>{{ results.expiration_date }}</td>
                                </tr>
                                <tr>
                                    <th>Updated Date</th>
                                    <td>{{ results.updated_date }}</td>
                                </tr>
                                <tr>
                                    <th>Name Servers</th>
                                    <td class="text-break">{{ results.name_servers }}</td>
                                </tr>
                                <tr>
                                    <th>Organization</th>
                                    <td>{{ results.org }}</td>
                                </tr>
                                <tr>
                                    <th>Contact Emails</th>
                                    <td>{{ results.emails }}</td>
                                </tr>
                                <tr>
                                    <th>Domain Status</th>
                                    <td class="text-break small">{{ results.status }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="accordion shadow-sm" id="accordionRaw">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingRaw">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRaw" aria-expanded="false" aria-controls="collapseRaw">
                            View Raw WHOIS Response
                        </button>
                    </h2>
                    <div id="collapseRaw" class="accordion-collapse collapse" aria-labelledby="headingRaw" data-bs-parent="#accordionRaw">
                        <div class="accordion-body">
                            <pre class="bg-light p-3 border rounded text-dark" style="white-space: pre-wrap; word-break: break-all;">{{ results.raw_text }}</pre>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

        </div>
    </div>
    <div class="mt-5 text-center">
        {% include 'includes/attribution.html' %}
    </div>
</div>
    {% if results %}
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const resultsDiv = document.getElementById("results-section");
                if (resultsDiv) {
                    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        </script>
    {% endif %}
{% endblock content %}