{% extends "projects/base.html" %}
{% load static %}

{% block meta_tags %}
  <meta name="description" content="Track the International Space Station (ISS) in real time and generate an ISS passover schedule for your ZIP code.">
  <meta name="keywords" content="ISS tracker, International Space Station, real-time ISS location, ISS altitude, ISS velocity, ISS passover schedule, ZIP code">

  <meta property="og:url" content="https://www.bencritt.net/projects/iss-tracker/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="ISS Tracker">
  <meta property="og:description" content="Track the International Space Station (ISS) in real time and generate an ISS passover schedule for your ZIP code.">
  <meta property="og:image" content="https://www.bencritt.net/static/img/all-projects/iss-tracker.webp">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:domain" content="bencritt.net">
  <meta name="twitter:url" content="https://www.bencritt.net/projects/iss-tracker/">
  <meta name="twitter:title" content="ISS Tracker">
  <meta name="twitter:description" content="Track the International Space Station (ISS) in real time and generate an ISS passover schedule for your ZIP code.">
  <meta name="twitter:image" content="https://www.bencritt.net/static/img/all-projects/iss-tracker.webp">
  <meta name="twitter:creator" content="@bencritt89"/>
{% endblock meta_tags %}

{% block link_tags %}
  <link rel="canonical" href="https://www.bencritt.net/projects/iss-tracker/">
  <link href="{% static 'template-css/iss-tracker-css.css' %}" rel="stylesheet">
{% endblock link_tags %}

{% block title %}ISS Tracker | Real-Time ISS Location and Passover Schedule{% endblock title %}

{% block content %}
  <section class="py-4">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">

          <header class="text-center mb-4">
            <h1 class="mb-2">ISS Tracker</h1>
            <p class="mb-0 text-muted">
              Track the International Space Station and generate a passover schedule for your ZIP code.
            </p>
          </header>

          <div class="alert alert-secondary iss-max-900" role="note">
            <p class="mb-0">
              I've temporarily disabled the ISS API due to a stability issue. The passover schedule feature still works.
            </p>
            <!--
            <form method="post">
              {% csrf_token %}
              {{ form.as_p }}
              <div class="d-grid">
                <input type="submit" id="iss-track-btn" class="btn btn-primary" value="Project ISS Passover Schedule" aria-label="Project ISS Passover Schedule">
              </div>
            </form>
            -->
          </div>

          <section class="mb-5" aria-labelledby="current-iss-data-heading">
            <h2 id="current-iss-data-heading" class="h3 mb-3">Current ISS Data</h2>

            <p id="iss-api-status" class="small text-muted mb-3"></p>

            <div class="table-responsive iss-max-900">
              <table class="table table-striped table-hover align-middle">
                <thead>
                  <tr>
                    <th scope="col">Metric</th>
                    <th scope="col">Value</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">Latitude</th>
                    <td id="iss-latitude">—</td>
                  </tr>
                  <tr>
                    <th scope="row">Longitude</th>
                    <td id="iss-longitude">—</td>
                  </tr>
                  <tr>
                    <th scope="row">Altitude</th>
                    <td id="iss-altitude">—</td>
                  </tr>
                  <tr>
                    <th scope="row">Velocity</th>
                    <td id="iss-velocity">—</td>
                  </tr>
                  <tr>
                    <th scope="row">Visibility</th>
                    <td id="iss-visibility">—</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </section>

          <section aria-label="ISS Passover Schedule">
            <h2 class="h3 mb-3">ISS Passover Schedule</h2>

            <div class="card shadow-sm iss-max-900">
              <div class="card-body">
                {% if error_message %}
                  <div class="alert alert-danger mt-3 mb-0" role="alert">
                    {{ error_message }}
                  </div>
                {% endif %}
              </div>
            </div>

            {% if iss_location_data %}
              <div class="table-responsive iss-max-900 mt-4">
                <table class="table table-striped table-hover align-middle">
                  <thead>
                    <tr>
                      <th scope="col">Field</th>
                      <th scope="col">Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in iss_location_data %}
                      <tr>
                        <th scope="row">{{ item.label }}</th>
                        <td>{{ item.value }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% endif %}

            {% if iss_passover_schedule %}
              <div class="table-responsive iss-max-900 mt-4">
                <table class="table table-striped table-hover align-middle">
                  <thead>
                    <tr>
                      <th scope="col">Date</th>
                      <th scope="col">Start</th>
                      <th scope="col">End</th>
                      <th scope="col">Duration</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for passover in iss_passover_schedule %}
                      <tr>
                        <td>{{ passover.date }}</td>
                        <td>{{ passover.start_time }}</td>
                        <td>{{ passover.end_time }}</td>
                        <td>{{ passover.duration }}</td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% endif %}
          </section>

          <div class="text-center mt-4">
            <a
              href="https://github.com/BenCritt/profile_workspace_heroku"
              target="_blank"
              rel="noopener noreferrer"
              class="btn btn-outline-secondary"
              data-bs-toggle="tooltip"
              title="View the source code for this app.">
              View source on GitHub
            </a>

            <p class="mt-3 text-muted small mb-0 iss-footer-text">
              This tool was created by
              <a href="{% url 'projects:home' %}" class="content-link" title="Ben Crittenden – IT Professional">Ben Crittenden</a>,
              an IT professional with experience in web development, systems administration, and project management.
            </p>
          </div>

        </div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const statusEl = document.getElementById("iss-api-status");

      // Best practice: build endpoint via Django URL routing
      const endpoint = "{% url 'projects:current_iss_data' %}";

      // If your API is disabled, you can bail early.
      // (Leave this block if you want the table to remain static while disabled.)
      if (statusEl) {
        statusEl.textContent = "ISS API currently disabled.";
      }

      // If/when you re-enable the API, you can fetch:
      // fetch(endpoint).then(...)

    });
  </script>
{% endblock content %}