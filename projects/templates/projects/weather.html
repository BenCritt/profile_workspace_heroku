{% extends "projects/base.html" %}
{% load static %}

{% block title %}Weather Forecast App | Accurate Weather by ZIP Code{% endblock title %}

{% block meta_tags %}
  <!-- Meta to prevent caching, which will prevent CSRF token errors. -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <meta name="description" content="Get accurate and detailed weather forecasts with our Weather Forecast App. Enter a ZIP code to receive real-time weather updates, including temperature, precipitation, and more. Powered by Google Maps and OpenWeatherMap APIs.">
  <meta name="keywords" content="Weather Forecast, ZIP Code Weather, Real-time Weather, Weather Updates">

  <!-- Open Graph -->
  <meta property="og:url" content="https://www.bencritt.net/projects/weather/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Weather Forecast App">
  <meta property="og:description" content="This weather forecast app takes a ZIP code and returns a forecast and other weather information.">
  <meta property="og:image" content="https://www.bencritt.net/static/img/all-projects/weather.webp">
  <meta property="og:image:type" content="image/webp">
  <meta property="og:image:alt" content="Weather Forecast Screenshot">
  <meta property="og:site_name" content="Ben Crittenden">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:domain" content="bencritt.net">
  <meta name="twitter:url" content="https://www.bencritt.net/projects/weather/">
  <meta name="twitter:title" content="Weather Forecast App">
  <meta name="twitter:description" content="This weather forecast app takes a ZIP code and returns a forecast and other weather information.">
  <meta name="twitter:image" content="https://www.bencritt.net/static/img/all-projects/weather.webp">
  <meta name="twitter:creator" content="@bencritt89"/>

  <!-- Schema -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Weather Forecast App",
      "description": "A web-based application that provides detailed weather forecasts based on ZIP code input using Google Maps and OpenWeatherMap APIs.",
      "url": "https://www.bencritt.net/projects/weather/",
      "applicationCategory": "Weather Forecasting Software",
      "operatingSystem": "Web-based",
      "image": "https://www.bencritt.net/static/img/all-projects/weather.webp",
      "creator": {
        "@type": "Person",
        "name": "Ben Crittenden",
        "url": "https://www.bencritt.net"
      }
    }
  </script>
{% endblock meta_tags %}

{% block link_tags %}
  <link rel="canonical" href="https://www.bencritt.net/projects/weather/">
  <link href="{% static 'template-css/weather-css.css' %}" rel="stylesheet">
{% endblock link_tags %}

{% block content %}
  <section class="py-4">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">

          <header class="text-center mb-4">
            <h1 class="mb-2">Weather Forecast App</h1>
            <p class="text-muted mb-0">Enter a ZIP code to get the current weather and daily forecast.</p>
          </header>

          {% if error_message %}
            <div class="alert alert-danger" role="alert">
              {{ error_message }}
            </div>
          {% endif %}

          <div class="card shadow-sm mb-4">
            <div class="card-body">
              {% if form.non_field_errors %}
                <div class="alert alert-danger" role="alert">
                  {{ form.non_field_errors }}
                </div>
              {% endif %}

              <form action="{% url 'projects:weather' %}" method="post" novalidate>
                {% csrf_token %}

                {% for field in form %}
                  <div class="mb-3">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.errors %}
                      <div class="invalid-feedback d-block">
                        {{ field.errors }}
                      </div>
                    {% endif %}
                  </div>
                {% endfor %}

                <div class="d-grid gap-2">
                  <input
                    type="submit"
                    id="weather-btn"
                    class="btn btn-primary"
                    value="Get Weather Forecast"
                    aria-label="Get Weather Forecast">
                </div>
              </form>
            </div>
          </div>

          {% if city_name and state_name %}
            <div class="text-center mb-3">
              <h2 class="h5 mb-0">Weather Forecast for {{ city_name }}, {{ state_name }}</h2>
            </div>
          {% endif %}

          {% if current_weather_report %}
            <div class="card shadow-sm mb-4">
              <div class="card-header">Current Weather Overview</div>
              <div class="card-body">
                {% for current in current_weather_report %}
                  <div class="d-flex align-items-center mb-3">
                    <img src="{{ current.icon_url_current }}" alt="Weather Icon" class="weather-icon">
                    <div class="ms-3">
                      <p class="mb-1"><strong>Description:</strong> {{ current.current_description }}</p>
                      <p class="mb-1"><strong>Temperature:</strong> {{ current.current_temperature }}°F</p>
                      <p class="mb-0"><strong>Humidity:</strong> {{ current.current_humidity }}%</p>
                    </div>
                  </div>

                  <hr>

                  <div class="row">
                    <div class="col-md-6">
                      <p class="mb-1"><strong>Wind Speed:</strong> {{ current.current_wind_speed }} mph</p>
                      <p class="mb-1"><strong>Wind Gusts:</strong> {{ current.current_wind_gust }} mph</p>
                      <p class="mb-0"><strong>Wind Direction:</strong> {{ current.current_wind_direction }}°</p>
                    </div>
                    <div class="col-md-6">
                      <p class="mb-1"><strong>UV Index:</strong> {{ current.current_uv }}</p>
                      <p class="mb-1"><strong>Dew Point:</strong> {{ current.current_dew }}°F</p>
                      <p class="mb-0"><strong>Cloud Coverage:</strong> {{ current.current_cloud }}%</p>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>

            <h2 class="h5 text-center mb-3">Daily Forecast</h2>

            <div class="accordion" id="dailyForecastAccordion">
              {% for day in daily_forecast %}
                <div class="accordion-item">
                  <h3 class="accordion-header" id="heading{{ forloop.counter }}">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapse{{ forloop.counter }}"
                      aria-expanded="false"
                      aria-controls="collapse{{ forloop.counter }}">
                      {{ day.day_of_week }}, {{ day.date_display }}
                    </button>
                  </h3>

                  <div
                    id="collapse{{ forloop.counter }}"
                    class="accordion-collapse collapse {% if forloop.first %}show{% endif %}"
                    aria-labelledby="heading{{ forloop.counter }}"
                    data-bs-parent="#dailyForecastAccordion">

                    <div class="accordion-body">
                      <p><strong>Forecast Summary:</strong> {{ day.summary }}.</p>
                      <p><strong>High Temp:</strong> {{ day.high_temp }}°F</p>
                      <p><strong>Low Temp:</strong> {{ day.low_temp }}°F</p>
                      <p><strong>Precipitation Chance:</strong> {{ day.precipitation_chance }}%</p>
                      <p><strong>Humidity:</strong> {{ day.humidity }}%</p>
                      <p><strong>Dew Point:</strong> {{ day.dew_point }}°F</p>

                      <p><strong>Morning Temp:</strong> {{ day.morn_temp }}°F <span class="text-muted">(Feels like: {{ day.morn_temp_feel }}°F)</span></p>
                      <p><strong>Day Temp:</strong> {{ day.day_temp }}°F <span class="text-muted">(Feels like: {{ day.day_temp_feel }}°F)</span></p>
                      <p><strong>Evening Temp:</strong> {{ day.eve_temp }}°F <span class="text-muted">(Feels like: {{ day.eve_temp_feel }}°F)</span></p>
                      <p class="mb-0"><strong>Night Temp:</strong> {{ day.night_temp }}°F <span class="text-muted">(Feels like: {{ day.night_temp_feel }}°F)</span></p>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endif %}

          <div class="text-center mt-4">
            <a
              href="https://github.com/BenCritt/profile_workspace_heroku"
              target="_blank"
              rel="noopener noreferrer"
              data-bs-toggle="tooltip"
              title="View the source code for this app."
              class="btn btn-outline-secondary">
              View source on GitHub
            </a>

            <p class="mt-3 text-muted small mb-0">
              This tool was created by
              <a href="/" class="content-link" title="Ben Crittenden – IT Professional">Ben Crittenden</a>,
              an IT professional with experience in web development, systems administration, and project management.
            </p>
          </div>

        </div>
      </div>
    </div>
  </section>
{% endblock content %}